var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__assign=this&&this.__assign||Object.assign||function(t){for(var e,i=1,s=arguments.length;s>i;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(a,n){function r(t){try{h(s.next(t))}catch(e){n(e)}}function o(t){try{h(s["throw"](t))}catch(e){n(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,o)}h((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,n&&(r=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(s){i=[6,s],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,n,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},Ball=function(t){function e(){var e=t.call(this)||this;return e.createScene(),e}return __extends(e,t),e.prototype.createScene=function(){this.ball=this.createBitmapByName("ball_png"),this.ball.width=10,this.ball.height=10,this.addChild(this.ball)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Ball.prototype,"Ball");var CXK=function(t){function e(){var e=t.call(this)||this;return e.speedBall=0,e.status=1,e.step=0,e.shotStatus=0,e.createScene(),e.addEventListener(egret.Event.ENTER_FRAME,e.changeIkun,e),e}return __extends(e,t),e.prototype.reset=function(){this.step=0},e.prototype.prepare=function(){this.step=1},e.prototype.shot=function(){this.step=2},e.prototype.createScene=function(){this.cxk=new egret.Bitmap,this.cxk.width=40,this.cxk.height=60,this.ball=this.createBitmapByName("ball_png"),this.ball.width=10,this.ball.height=10,this.ball.x=15,this.addChild(this.ball),this.addChild(this.cxk)},e.prototype.changeIkun=function(){0===this.step?(this.cxk.height=60,this.shotStatus=0,this.cxk.y=0,this.status>3&&(this.status=1,this.speedBall=0),this.status>2?this.cxk.texture=RES.getRes("paddle_2_png"):this.cxk.texture=RES.getRes("paddle_1_png"),this.status=this.status+.1,this.changeBall()):1===this.step?(this.cxk.texture=RES.getRes("paddle_2_png"),this.ball.y=30,this.cxk.height>40&&(this.cxk.height-=.6,this.cxk.y+=.6)):2===this.step&&(this.cxk.texture=RES.getRes("paddle_3_png"),this.cxk.height=62,this.cxk.y=0,this.shotStatus+=.4,this.shotStatus>1&&(this.cxk.texture=RES.getRes("paddle_4_png")))},e.prototype.changeBall=function(){this.status>2?this.ball.y=15+10*this.speedBall:this.ball.y=40-10*this.speedBall,this.speedBall+=.15},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(CXK.prototype,"CXK");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.textColor=5619787,this.textField.width=480,this.textField.height=100},e.prototype.onProgress=function(t,e){this.textField.text="正在加载..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var getTimer=egret.getTimer,Main=function(t){function e(){var e=t.call(this)||this;return e.ballT=0,e.gameStatus=0,e.powerEarn=0,e.ballCount=10,e.totalPoint=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onTouchBeginState,e),e.addEventListener(egret.TouchEvent.TOUCH_END,e.onTouchEndState,e),e.addEventListener(egret.Event.ENTER_FRAME,e.onEnterFrame,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.scale_intro=RES.getRes("scale_intro_mp3"),this.scale_circle=RES.getRes("scale_loop_mp3"),this.shotSound=RES.getRes("launch_mp3"),this.bingoSound=RES.getRes("point_mp3"),this.dieSound=RES.getRes("die_mp3"),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.drawBallCountAndScore=function(){this.ballCountText.text="x"+this.ballCount.toString(),this.pointText.text="得分："+this.totalPoint.toString()},e.prototype.createGameScene=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,i=new egret.Shape;i.graphics.beginFill(16777215,1),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),this.addChild(i);var s=this.createBitmapByName("bg_png");this.addChild(s),s.width=t,s.height=t/(1102/1172),s.y=(e-s.height)/2,this.cxk=new CXK,this.addChild(this.cxk),this.cxk.x=349,this.cxk.y=s.y+231;var a=new Ball;this.addChild(a),a.x=156,a.y=325,a.alpha=0,this.ball2=a,this.touchEnabled=!0,this.scoreboardImg=new ScoreBoard,this.scoreboardImg.touchEnabled=!0,this.scoreboardImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restart,this);var n=new egret.TextField;this.addChild(n),n.textColor=1748249,n.x=200,n.y=900,n.text="长按蓄力，松开投球",this.pointText=new egret.TextField,this.addChild(this.pointText),this.pointText.x=400,this.pointText.y=5,this.pointText.textColor=3355443,this.pointText.size=28,this.ballCountText=new egret.TextField,this.addChild(this.ballCountText),this.ballCountText.x=60,this.ballCountText.y=5,this.ballCountText.size=28,this.ballCountText.textColor=3355443,this.ball3=this.createBitmapByName("ball_png"),this.addChild(this.ball3),this.ball3.y=5,this.ball3.x=25,this.ball3.width=25,this.ball3.height=25,this.drawBallCountAndScore()},e.prototype.restart=function(){console.log("restart"),4===this.gameStatus&&(this.removeChild(this.scoreboardImg),this.gameStatus=0,this.totalPoint=0,this.ballCount=10,this.drawBallCountAndScore())},e.prototype.onEnterFrame=function(){(2===this.gameStatus||3===this.gameStatus)&&this.ballSport(),1===this.gameStatus&&(this.powerEarn=this.powerEarn+1/66)},e.prototype.onTouchBeginState=function(){var t=this;console.log("touch begin"),0===this.gameStatus&&(this.gameStatus=1,this.powerEarn=0,this.ballT=0,this.scaleChannel=this.scale_intro.play(0,1),setTimeout(function(){1===t.gameStatus&&(t.scaleChannel.stop(),t.scaleChannel=t.scale_circle.play(0,0))},2200),this.cxk.prepare())},e.prototype.onTouchEndState=function(){console.log("touch end"),1===this.gameStatus&&(this.ballT=0,this.gameStatus=2,this.scaleChannel.stop(),this.shotSound.play(0,1),this.cxk.shot(),this.ballCount--,this.drawBallCountAndScore(),this.ball=new Ball,this.addChild(this.ball),this.ball.alpha=0)},e.prototype.ballSport=function(){var t=this,e=.015,i=this.ballT,s={x:350,y:445},a={x:250,y:200+320*(.5-this.powerEarn)},n=__assign({},a),r={x:100+160*(.5-this.powerEarn),y:400},o=3*(a.x-s.x),h=3*(n.x-a.x)-o,l=r.x-s.x-o-h,c=3*(a.y-s.y),u=3*(n.y-a.y)-c,d=r.y-s.y-c-u,p=l*(i*i*i)+h*(i*i)+o*i+s.x,g=d*(i*i*i)+u*(i*i)+c*i+s.y;this.ballT+=e,this.ballT>1&&(this.ballT=1),this.ball.alpha=1;var x=function(){t.gameStatus=0,t.cxk.reset(),t.removeChild(t.ball),t.ballCount<=0&&(t.gameStatus=4,t.addChildAt(t.scoreboardImg,10),t.scoreboardImg.x=(t.stage.stageWidth-t.scoreboardImg.scoreBoard.width)/2,t.scoreboardImg.y=(t.stage.stageHeight-t.scoreboardImg.scoreBoard.height)/2,console.log(t.scoreboardImg.x,t.scoreboardImg.y),t.scoreboardImg.setCurrentPoint(t.totalPoint)),t.drawBallCountAndScore()};if(3===this.gameStatus)this.ball.y=g,g>=r.y-1&&(this.totalPoint++,x());else if(2===this.gameStatus){var y=this.ball2.hitTestPoint(this.ball.x+5,this.ball.y+5);y&&(this.bingoSound.play(0,1),this.gameStatus=3),this.ball.x=p,this.ball.y=g}this.ball.y>=r.y-1&&this.ball.x<=r.x+1&&2===this.gameStatus&&(this.dieSound.play(0,1),x())},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var ScoreBoard=function(t){function e(){var e=t.call(this)||this;return e.currentPoint=0,e.maxPoint=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap;return e.texture=RES.getRes(t),e},e.prototype.setCurrentPoint=function(t){this.currentPoint=t,t>this.maxPoint&&(this.maxPoint=t),this.currentPointText.text=this.currentPoint+"",this.maxPointText.text=this.maxPoint+""},e.prototype.init=function(){var t=new egret.DisplayObjectContainer;this.scoreBoard=this.createBitmapByName("scoreboard_png"),t.width=this.scoreBoard.width,t.height=this.scoreBoard.height,this.width=t.width,this.height=t.height,t.addChild(this.scoreBoard),this.currentPointText=new egret.TextField,this.maxPointText=new egret.TextField,t.addChild(this.currentPointText),t.addChild(this.maxPointText),this.currentPointText.y=this.scoreBoard.height/2.5,this.currentPointText.textColor=13369344,this.maxPointText.textColor=13369344,this.maxPointText.y=this.scoreBoard.height/1.65,this.currentPointText.x=this.scoreBoard.width/2,this.maxPointText.x=this.scoreBoard.width/2,this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(ScoreBoard.prototype,"ScoreBoard");